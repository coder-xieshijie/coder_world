

![jvm_garbage_collection](https://coder-xieshijie-img-1253784930.cos.ap-beijing.myqcloud.com/img/2024/jvm_garbage_collection_d572d398769f9f08544db157bf5307d0.png)



> å“ˆå–½ï¼Œå¤§å®¶å¥½ğŸ‰ï¼Œæˆ‘æ˜¯**ä¸–æ°**ã€‚
>
> æ¬¢è¿å¤§å®¶å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€**ç¨‹åºå‘˜ä¸–æ°**ã€è·å–æ›´å¤šåç«¯æŠ€æœ¯å¹²è´§ğŸ‰ğŸ‰!
>
> æœ¬æ–‡æˆ‘ä¸ºå¤§å®¶ä»‹ç»ã€Œ**JVMåƒåœ¾å›æ”¶é‚£äº›äº‹**ã€





## é¢è¯•è¿ç¯call

1. å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦åº”è¢«å›æ”¶?
2. finalizeæ–¹æ³•çš„å®ç°æœºåˆ¶æ˜¯ä»€ä¹ˆ?
3. å¦‚ä½•åˆ¤æ–­ç±»åº”è¯¥è¢«å›æ”¶?
4. åƒåœ¾å›æ”¶ç®—æ³•éƒ½æœ‰ä»€ä¹ˆ? ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆ?
5. Minor GC, Major GC, Full GC åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆ?
6. JVMéƒ½æœ‰å“ªäº›å†…å­˜åˆ†é…ç­–ç•¥?



## 1. å¯¹è±¡å›æ”¶åˆ¤æ–­

### 1.1 å¼•ç”¨è®¡æ•°ç®—æ³•

ã€Œ**å®šä¹‰**ã€

ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºä¹‹åï¼Œç³»ç»Ÿä¼šç»™è¿™ä¸ªå¯¹è±¡åˆå§‹åŒ–ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“è¿™ä¸ªå¯¹è±¡è¢«å¼•ç”¨äº†ï¼Œåˆ™è®¡æ•°å™¨ +1ï¼Œè€Œå½“è¯¥å¼•ç”¨å¤±æ•ˆåï¼Œè®¡æ•°å™¨ä¾¿ -1ï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º 0ï¼Œæ„å‘³ç€è¯¥å¯¹è±¡ä¸å†è¢«ä½¿ç”¨äº†ï¼Œåˆ™å¯ä»¥å°†å…¶è¿›è¡Œå›æ”¶äº†ã€‚

ã€Œ**å­˜åœ¨é—®é¢˜**ã€

ä¸¤ä¸ªå¯¹è±¡å‡ºç°å¾ªç¯å¼•ç”¨çš„æƒ…å†µä¸‹ï¼Œæ­¤æ—¶å¼•ç”¨è®¡æ•°å™¨æ°¸è¿œä¸ä¸º 0ï¼Œå¯¼è‡´æ— æ³•å¯¹å®ƒä»¬è¿›è¡Œå›æ”¶ã€‚



![å¯¹è±¡ä¹‹é—´å¾ªç¯å¼•ç”¨](https://coder-xieshijie-img-1253784930.cos.ap-beijing.myqcloud.com/img/2024/object-circular-reference_283216807d7a4216d004cca6dbbbba8b.png)



### 1.2 å¯è¾¾æ€§åˆ†æç®—æ³•

ã€Œ**å®šä¹‰**ã€

ä»¥ GC Roots ä½œä¸ºèµ·å§‹ç‚¹è¿›è¡Œæœç´¢ï¼Œä¸€æ­¥æ­¥éå†æ‰¾åˆ°å’Œè¿™ä¸ªæ ¹å¯¹è±¡å…·æœ‰å¼•ç”¨å…³ç³»çš„å¯¹è±¡ï¼Œç„¶åå†ä»è¿™äº›å¯¹è±¡å¼€å§‹ç»§ç»­å¯»æ‰¾ï¼Œèƒ½å¤Ÿåˆ°è¾¾åˆ°çš„å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å¯è¢«å›æ”¶ã€‚



![image](https://coder-xieshijie-img-1253784930.cos.ap-beijing.myqcloud.com/img/2024/0635cbe8_20d5b3210e221a4ef89d84e114480f30.png)

åœ¨ Java ä¸­ GC Roots ä¸€èˆ¬åŒ…å«ä»¥ä¸‹å†…å®¹:

- **è™šæ‹Ÿæœºæ ˆ**ä¸­å¼•ç”¨çš„å¯¹è±¡
- **æœ¬åœ°æ–¹æ³•æ ˆ**ä¸­å¼•ç”¨çš„å¯¹è±¡
- æ–¹æ³•åŒºä¸­**ç±»é™æ€å±æ€§**å¼•ç”¨çš„å¯¹è±¡
- æ–¹æ³•åŒºä¸­çš„**å¸¸é‡å¼•ç”¨**çš„å¯¹è±¡

### 1.3 finalize()

> **å¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼Œå°±ä»£è¡¨ä¸€å®šä¼šè¢«å›æ”¶å—**ï¼Ÿ

å³ä½¿åœ¨å¯è¾¾æ€§åˆ†ææ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿå¹¶ä¸æ˜¯ç«‹åˆ»å›æ”¶ã€‚å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†**ä¸¤æ¬¡æ ‡è®°**



ã€Œ**ç¬¬ä¸€æ¬¡æ ‡è®°**ã€

å¦‚æœå¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æç®—æ³•ä¹‹åå‘ç°æœªä¸ GC Roots å¼•ç”¨é“¾ç›¸è¿ï¼Œé‚£å®ƒå°†ä¼šç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ã€‚å½“å¯¹è±¡**æ²¡æœ‰è¦†ç›– finalize () æ–¹æ³•**ã€æˆ–è€… **finalize () æ–¹æ³•å·²ç»è¢« JVM æ‰§è¡Œè¿‡**ï¼Œåˆ™åˆ¤å®šä¸º**å¯å›æ”¶å¯¹è±¡**ã€‚å¦‚æœå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize () æ–¹æ³•ï¼Œåˆ™è¢«æ”¾å…¥ **F-Queue é˜Ÿåˆ—**ä¸­ã€‚ç¨ååœ¨ JVM è‡ªåŠ¨å»ºç«‹ã€ä½ä¼˜å…ˆçº§çš„ Finalizer çº¿ç¨‹ï¼ˆå¯èƒ½å¤šä¸ªçº¿ç¨‹ï¼‰ä¸­è§¦å‘è¿™ä¸ªæ–¹æ³•.



ã€Œ**ç¬¬äºŒæ¬¡æ ‡è®°**ã€

GC å¯¹ F-Queue é˜Ÿåˆ—ä¸­çš„å¯¹è±¡è¿›è¡ŒäºŒæ¬¡æ ‡è®°ã€‚å¦‚æœå¯¹è±¡åœ¨ finalize () æ–¹æ³•ä¸­**é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹äº†å…³è”**ï¼Œé‚£ä¹ˆäºŒæ¬¡æ ‡è®°æ—¶åˆ™ä¼šå°†å®ƒç§»å‡º â€œå³å°†å›æ”¶â€ é›†åˆã€‚å¦‚æœæ­¤æ—¶å¯¹è±¡è¿˜æ²¡æˆåŠŸé€ƒè„±ï¼Œé‚£ä¹ˆåªèƒ½è¢«å›æ”¶äº†ã€‚



**æ³¨æ„ âš ï¸**ï¼šJDK9 ç‰ˆæœ¬åŠåç»­ç‰ˆæœ¬ä¸­å„ä¸ªç±»ä¸­çš„ `finalize` æ–¹æ³•ä¼šè¢«é€æ¸å¼ƒç”¨ç§»é™¤ã€‚å¿˜æ‰å®ƒçš„å­˜åœ¨å§ï¼



-----

## 2. ç±»å›æ”¶åˆ¤æ–­

> åœ¨å¤§é‡ä½¿ç”¨åå°„ã€åŠ¨æ€ä»£ç†ã€CGLib ç­‰ ByteCode æ¡†æ¶ã€åŠ¨æ€ç”Ÿæˆ JSP ä»¥åŠ OSGi è¿™ç±»é¢‘ç¹**è‡ªå®šä¹‰ ClassLoader** çš„åœºæ™¯éƒ½éœ€è¦è™šæ‹Ÿæœºå…·å¤‡**ç±»å¸è½½**åŠŸèƒ½ï¼Œä»¥ä¿è¯ä¸ä¼šå‡ºç°å†…å­˜æº¢å‡ºã€‚

JVMæ–¹æ³•åŒºå­˜å‚¨çš„æ˜¯ç±»ä¿¡æ¯ï¼Œå› æ­¤ä¸»è¦é’ˆå¯¹**æ–¹æ³•åŒº**è¿›è¡Œç±»å›æ”¶ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯**æ— ç”¨çš„ç±»**çš„å‘¢ï¼Ÿ

ç±»éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ 3 ä¸ªæ¡ä»¶æ‰èƒ½ç®—æ˜¯ **â€œæ— ç”¨çš„ç±»â€**ï¼š

- è¯¥ç±»**æ‰€æœ‰çš„å®ä¾‹**éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚
- åŠ è½½è¯¥ç±»çš„ `ClassLoader` å·²ç»è¢«å›æ”¶ã€‚
- è¯¥ç±»å¯¹åº”çš„ `java.lang.Class` å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚

è™šæ‹Ÿæœºå¯ä»¥å¯¹æ»¡è¶³ä¸Šè¿° 3 ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œè¿™é‡Œè¯´çš„ä»…ä»…æ˜¯â€œ**å¯ä»¥**â€ï¼Œè€Œå¹¶**ä¸æ˜¯å’Œå¯¹è±¡ä¸€æ ·ä¸ä½¿ç”¨å°±ä¼šå¿…ç„¶è¢«å›æ”¶**ã€‚



-----



## 3. åƒåœ¾å›æ”¶ç®—æ³•

### 3.1 æ ‡è®°-æ¸…é™¤

> å°†å­˜æ´»çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œç„¶åæ¸…ç†æ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ã€‚

è¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºæœ¬çš„GCç®—æ³•ï¼Œå®ƒæ˜¯ç°ä»£GCç®—æ³•çš„æ€æƒ³åŸºç¡€ï¼Œåˆ†ä¸º**æ ‡è®°å’Œæ¸…é™¤**ä¸¤ä¸ªé˜¶æ®µï¼šå…ˆæŠŠæ‰€æœ‰æ´»åŠ¨çš„**å¯¹è±¡æ ‡è®°ï¼ˆå¯è¾¾æ€§åˆ†ææ³•ï¼‰**å‡ºæ¥ï¼Œç„¶åæŠŠæ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡**ç»Ÿä¸€æ¸…é™¤æ‰**ã€‚

![image](https://coder-xieshijie-img-1253784930.cos.ap-beijing.myqcloud.com/img/2024/a4248c4b-6c1d-4fb8-a557-86da92d3a294_5ec7729bafe7ff7e6c86e18eafbf4ff6.jpg)

ã€Œ**ä¸è¶³**ã€

- æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹æ•ˆç‡éƒ½ä¸é«˜ï¼›
- ä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´æ— æ³•ç»™å¤§å¯¹è±¡åˆ†é…å†…å­˜ã€‚



### 3.2 æ ‡è®°-æ•´ç†

> è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚

æ ‡è®°â€”æ•´ç†ç®—æ³•é€‚ç”¨äº**å­˜æ´»å¯¹è±¡è¾ƒå¤š**çš„åœºåˆï¼Œå®ƒçš„æ ‡è®°é˜¶æ®µå’Œæ ‡è®°-æ¸…é™¤ç®—æ³•ä¸­çš„ä¸€æ ·ã€‚æ•´ç†é˜¶æ®µæ˜¯å°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°**å†…å­˜çš„ä¸€ç«¯**ï¼Œä¹‹å**æ¸…ç†è¾¹ç•Œå¤–æ‰€æœ‰çš„ç©ºé—´**ã€‚å®ƒçš„æ•ˆç‡ä¹Ÿä¸é«˜ã€‚

![image](https://coder-xieshijie-img-1253784930.cos.ap-beijing.myqcloud.com/img/2024/902b83ab-8054-4bd2-898f-9a4a0fe52830_7b27a9d1865d0c8f0a7eae5c66d90dff.jpg)



### 3.3 å¤åˆ¶

> å°†å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åª**ä½¿ç”¨å…¶ä¸­ä¸€å—**ï¼Œå½“è¿™ä¸€å—å†…å­˜ç”¨å®Œäº†å°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡**å¤åˆ¶åˆ°å¦ä¸€å—**ä¸Šé¢ï¼Œç„¶åå†æŠŠä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´è¿›è¡Œä¸€æ¬¡æ¸…ç†ã€‚

å®ƒæ¯”æ ‡è®°-æ¸…é™¤ç®—æ³•è¦**é«˜æ•ˆ**ï¼Œä½†ä¸é€‚ç”¨äº**å­˜æ´»å¯¹è±¡è¾ƒå¤š**çš„å†…å­˜ï¼Œå› ä¸ºå¤åˆ¶çš„æ—¶å€™ä¼šæœ‰è¾ƒå¤šçš„æ—¶é—´æ¶ˆè€—ã€‚å®ƒçš„è‡´å‘½ç¼ºç‚¹æ˜¯ä¼šæœ‰**ä¸€åŠçš„å†…å­˜æµªè´¹**ã€‚

![image](https://coder-xieshijie-img-1253784930.cos.ap-beijing.myqcloud.com/img/2024/e6b733ad-606d-4028-b3e8-83c3a73a3797_fc6098ebb1edd9244fbfcf9d7030054a.jpg)



ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½é‡‡ç”¨è¿™ç§æ”¶é›†ç®—æ³•æ¥å›æ”¶æ–°ç”Ÿä»£ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å°†æ–°ç”Ÿä»£åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œè€Œæ˜¯åˆ†ä¸ºä¸€å—**è¾ƒå¤§çš„ Eden ç©ºé—´**å’Œä¸¤å—**è¾ƒå°çš„ Survivor ç©ºé—´**ï¼Œæ¯æ¬¡ä½¿ç”¨ Eden ç©ºé—´å’Œå…¶ä¸­ä¸€å— Survivorã€‚åœ¨å›æ”¶æ—¶ï¼Œå°† Eden å’Œ Survivor ä¸­è¿˜å­˜æ´»ç€çš„å¯¹è±¡ä¸€æ¬¡æ€§å¤åˆ¶åˆ°å¦ä¸€å— Survivor ç©ºé—´ä¸Šï¼Œæœ€åæ¸…ç† Eden å’Œä½¿ç”¨è¿‡çš„é‚£ä¸€å— Survivorã€‚



### 3.4 åˆ†ä»£æ”¶é›†

ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºé‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå®ƒæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸åŒå—é‡‡ç”¨é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚

ä¸€èˆ¬å°†å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚

- **æ–°ç”Ÿä»£**ä½¿ç”¨: **å¤åˆ¶ç®—æ³•**
- **è€å¹´ä»£**ä½¿ç”¨: **æ ‡è®°-æ¸…é™¤** æˆ–è€… **æ ‡è®°-æ•´ç†** ç®—æ³•



ã€**æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰**ã€

> æ‰€æœ‰æ–°ç”Ÿæˆçš„å¯¹è±¡é¦–å…ˆéƒ½æ˜¯æ”¾åœ¨æ–°ç”Ÿä»£çš„ã€‚æ–°ç”Ÿä»£çš„ç›®æ ‡å°±æ˜¯å°½å¯èƒ½å¿«é€Ÿçš„æ”¶é›†æ‰é‚£äº›ç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡ã€‚

- æ–°ç”Ÿä»£å†…å­˜åˆ†é…ä¸€å—**è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„ Survivor** ç©ºé—´ï¼ˆé»˜è®¤ Eden å’Œ Survivor çš„å¤§å°æ¯”ä¾‹æ˜¯ **8:1**ï¼‰ã€‚æ¯æ¬¡ä½¿ç”¨ Eden å’Œå…¶ä¸­ä¸€å— Survivor ç©ºé—´ï¼ˆ**å½“Edenå†…å­˜æ»¡äº†å°±ä¼šæŠŠå¯¹è±¡åˆ†é…åˆ°SurvivoråŒº**ï¼‰
- å›æ”¶æ—¶å°† `Eden` å’Œ `Survivor` ç©ºé—´ä¸­**å­˜æ´»çš„å¯¹è±¡**ä¸€æ¬¡æ€§å¤åˆ¶åˆ°å¦ä¸€å— Survivor ç©ºé—´ä¸Šã€‚æœ€åæ¸…ç†æ‰ Eden å’Œä½¿ç”¨è¿‡çš„ Survivor ç©ºé—´ã€‚Survivor åŒºæ€»æœ‰ä¸€ä¸ªæ˜¯ç©ºçš„ã€‚
- å¦‚æœå¦ä¸€å— `Survivor` ç©ºé—´æ²¡æœ‰è¶³å¤Ÿå†…å­˜æ¥å­˜æ”¾ä¸Šä¸€æ¬¡æ–°ç”Ÿä»£æ”¶é›†ä¸‹æ¥çš„å­˜æ´»å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™äº›å¯¹è±¡åˆ™ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚
- æ–°ç”Ÿä»£å‘ç”Ÿçš„GCä¹Ÿå«åš`Minor GC`ï¼ŒMinorGCå‘ç”Ÿé¢‘ç‡æ¯”è¾ƒé«˜(ä¸ä¸€å®šç­‰EdenåŒºæ»¡äº†æ‰è§¦å‘)ã€‚

![img](https://coder-xieshijie-img-1253784930.cos.ap-beijing.myqcloud.com/img/2024/hotspot-heap-structure_2afd3c710fd504ce700f79a8facc2344.png)



ã€**è€å¹´ä»£ï¼ˆOld Generationï¼‰**ã€

- åœ¨æ–°ç”Ÿä»£ä¸­ç»å†äº† N æ¬¡åƒåœ¾å›æ”¶åä»ç„¶å­˜æ´»çš„å¯¹è±¡ï¼Œå°±ä¼šè¢«æ”¾åˆ°è€å¹´ä»£ä¸­ã€‚å› æ­¤ï¼Œå¯ä»¥è®¤ä¸º**è€å¹´ä»£ä¸­å­˜æ”¾çš„éƒ½æ˜¯ä¸€äº›ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡**ã€‚
- å†…å­˜æ¯”æ–°ç”Ÿä»£ä¹Ÿå¤§å¾ˆå¤š(å¤§æ¦‚æ¯”ä¾‹æ˜¯1:2)ï¼Œå½“è€å¹´ä»£å†…å­˜æ»¡æ—¶è§¦å‘ `Major` æˆ–è€… `Full GC`ï¼Œå‘ç”Ÿé¢‘ç‡æ¯”è¾ƒä½ï¼Œè€å¹´ä»£å¯¹è±¡å­˜æ´»æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå­˜æ´»ç‡æ ‡è®°é«˜



-----



## 4. Minor GCã€Major GCã€Full GC

- **Minor GC/Young GC**ï¼šåªæ˜¯æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†
- **Major GC/Old GC**ï¼šåªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›† 
  - ç›®å‰ï¼Œåªæœ‰ CMS GC ä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸º
  - å¾ˆå¤šæ—¶å€™ Major GC ä¼šå’Œ Full GC **æ··åˆä½¿ç”¨**ï¼Œéœ€è¦å…·ä½“åˆ†è¾¨æ˜¯è€å¹´ä»£å›æ”¶è¿˜æ˜¯æ•´å †å›æ”¶
- **Mixed GC**ï¼šæ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›† 
  - ç›®å‰åªæœ‰ `G1 GC` ä¼šæœ‰è¿™ç§è¡Œä¸º

- **Full GC**ï¼šæ”¶é›†æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾

![img](https://coder-xieshijie-img-1253784930.cos.ap-beijing.myqcloud.com/img/2024/jvm_memory_abf117588724c9121093de5253a6ac94.png)

> å¯¹äº Minor GCï¼Œå…¶è§¦å‘æ¡ä»¶éå¸¸ç®€å•ï¼Œå½“ Eden ç©ºé—´æ»¡æ—¶ï¼Œå°±å°†è§¦å‘ä¸€æ¬¡ Minor GCã€‚è€Œ Full GC åˆ™ç›¸å¯¹å¤æ‚ï¼Œæœ‰ä»¥ä¸‹æ¡ä»¶:

1. è°ƒç”¨ System.gc()

2. è€å¹´ä»£ç©ºé—´ä¸è¶³

3. ç©ºé—´åˆ†é…æ‹…ä¿å¤±è´¥

4. JDK 1.7 åŠä»¥å‰çš„æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³

5. Concurrent Mode Failure 



**æ³¨æ„ âš ï¸**ï¼šConcurrent Mode Failure æ˜¯ CMS ç‰¹æœ‰è¡Œä¸ºï¼Œæ‰§è¡Œ CMS GC çš„è¿‡ç¨‹ä¸­åŒæ—¶æœ‰å¯¹è±¡è¦æ”¾å…¥è€å¹´ä»£ï¼Œè€Œæ­¤æ—¶è€å¹´ä»£ç©ºé—´ä¸è¶³(å¯èƒ½æ˜¯ GC è¿‡ç¨‹ä¸­æµ®åŠ¨åƒåœ¾è¿‡å¤šå¯¼è‡´æš‚æ—¶æ€§çš„ç©ºé—´ä¸è¶³)ï¼Œä¾¿ä¼šæŠ¥ Concurrent Mode Failure é”™è¯¯ï¼Œå¹¶è§¦å‘ Full GCã€‚



--------



## 5. å†…å­˜åˆ†é…ç­–ç•¥

> JVM**ä¸ºå¯¹è±¡åˆ†é…å†…å­˜**æ—¶ï¼Œä¼šæœ‰ä¸€äº›åˆ†é…ç­–ç•¥ä¿è¯æ›´å¥½çš„ä½¿ç”¨å’Œå›æ”¶å¯¹è±¡

### 5.1 å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åˆ†é…

- å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ Eden åŒºåˆ†é…ï¼Œå½“ Eden åŒºç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå‘èµ· Minor GCã€‚



### 5.2 å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£

- å¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦**è¿ç»­å†…å­˜ç©ºé—´**çš„å¯¹è±¡ï¼Œæœ€å…¸å‹çš„å¤§å¯¹è±¡æ˜¯é‚£ç§å¾ˆé•¿çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ã€‚

- ç»å¸¸å‡ºç°å¤§å¯¹è±¡ä¼šæå‰è§¦å‘åƒåœ¾æ”¶é›†ä»¥è·å–è¶³å¤Ÿçš„è¿ç»­ç©ºé—´åˆ†é…ç»™å¤§å¯¹è±¡ã€‚

- -XX:PretenureSizeThresholdï¼Œå¤§äºæ­¤å€¼çš„å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œé¿å…åœ¨ Eden åŒºå’Œ Survivor åŒºä¹‹é—´çš„å¤§é‡å†…å­˜å¤åˆ¶ã€‚



### 5.3 é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£

- ä¸ºå¯¹è±¡å®šä¹‰å¹´é¾„è®¡æ•°å™¨ï¼Œå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ Minor GC ä¾ç„¶å­˜æ´»ï¼Œå°†ç§»åŠ¨åˆ° Survivor ä¸­ï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå¢åŠ åˆ°ä¸€å®šå¹´é¾„åˆ™ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚

- -XX:MaxTenuringThreshold ç”¨æ¥å®šä¹‰å¹´é¾„çš„é˜ˆå€¼ã€‚



### 5.4 åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š

- è™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œåœ°è¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ° MaxTenuringThreshold æ‰èƒ½æ™‹å‡è€å¹´ä»£ï¼Œå¦‚æœåœ¨ Survivor ä¸­**ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œ**å¤§äº Survivor ç©ºé—´çš„ä¸€åŠï¼Œåˆ™**å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£**ï¼Œæ— éœ€ç­‰åˆ° MaxTenuringThreshold ä¸­è¦æ±‚çš„å¹´é¾„ã€‚



### 5.5 ç©ºé—´åˆ†é…æ‹…ä¿

- åœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå…ˆæ£€æŸ¥è€å¹´ä»£**æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´**ï¼Œå¦‚æœæ¡ä»¶æˆç«‹çš„è¯ï¼Œé‚£ä¹ˆ Minor GC å¯ä»¥ç¡®è®¤æ˜¯å®‰å…¨çš„ã€‚

- ç©ºé—´åˆ†é…æ‹…ä¿æ˜¯ä¸ºäº†ç¡®ä¿åœ¨ Minor GC ä¹‹å‰è€å¹´ä»£æœ¬èº«è¿˜æœ‰å®¹çº³æ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„å‰©ä½™ç©ºé—´ã€‚
- å¦‚æœç©ºé—´åˆ†é…æ‹…ä¿**å¤±è´¥**åˆ™ä¼šè¿›è¡Œ `Full GC`



> å‚è€ƒæ–‡ç« 

[ã€006ã€‘ååˆ†é’Ÿææ‡‚ Java åƒåœ¾å›æ”¶](https://mp.weixin.qq.com/s?__biz=MzIxNzM0NjA1OQ==&mid=2247483723&idx=1&sn=5b5e57f842d652732bbab73b61d2d1fd&chksm=97fa782fa08df139857b3ccf8d6a15a20ed401838e40451fb1612ab3a3bf185445d4c8fa50e4&scene=126&sessionid=1720533881#rd)

[Java åƒåœ¾å›æ”¶åŸºç¡€çŸ¥è¯†](https://pdai.tech/md/java/jvm/java-jvm-gc.html)

[JVMåƒåœ¾å›æ”¶è¯¦è§£ï¼ˆé‡ç‚¹ï¼‰](https://javaguide.cn/java/jvm/jvm-garbage-collection.html)

[JVMä¹‹åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰](https://juejin.cn/post/7123853933801373733)





